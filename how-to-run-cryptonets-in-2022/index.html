<!doctype html><html lang=en><head><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1"><meta name=description content="My Blog"><link rel="shortcut icon" href=https://whcjimmy.github.io/favicon.ico><link rel=stylesheet href=/css/style.min.css><link rel=canonical href=https://whcjimmy.github.io/how-to-run-cryptonets-in-2022/><title>How to Run CryptoNets in 2022</title></head><body><header id=banner><h2><a href=https://whcjimmy.github.io>知日</a></h2><nav><ul><li><a href=/ title=posts>posts</a></li><li><a href=/about/ title=about>about</a></li></ul></nav></header><main id=content><article><header id=post-header><h1>How to Run CryptoNets in 2022</h1><div><time>February 23, 2022</time></div></header><p>This is a post about how to install and run CryptoNets in 2022.</p><h1 id=introduction>Introduction</h1><p>More and more companies have built applications based on big data techniques in recent years. To have a well-performance model, collecting data has become a must. However, the consciousness of privacy raises in many people’s minds, and they are less willing to give data to companies. As a result, data protection has become a vital technique to balance the dilemma between big data and data privacy.</p><p>In 2016, Microsoft Research published CryptoNets [1], the first paper to infer a CNN model in the encrypted domain. The main idea of CryptoNets is to infer encrypted data in the encrypted domain, and the protocol is under a client who has sensible data and a company that has a CNN model. At the beginning of the protocol, a client encrypts his data with his public key and sends it to the company. Next, when the company receives the encrypted image, he infers the image in the encrypted domain and sends the result back to the client. After the client gets the encrypted result, he decrypts the result with his private key, and now he gets the meaning of the result. Because the whole process is in the encrypted domain, the company doesn’t have any information about this image. As a result, CryptoNets can effectively protect data privacy.</p><p>Although CryptoNets is good for beginners to know how to infer data in the encrypted domain, after Microsoft Research released related code in 2019, the code doesn’t be updated anymore. In this post, I will tell you how to run CryptoNets in 2022.</p><h1 id=prerequisites>Prerequisites</h1><p>Before we start, we need the following things:</p><ol><li><p><strong>Visual Studio 2022</strong></p><p>Microsoft Research wrote CryptoNets in C#, so we need VS to compile the project. The installation instructions are in the next section.</p></li><li><p><strong>SEAL Repo</strong></p><p>I&rsquo;ve updated the setting files for VS 2022, so I recommend you clone the branch <code>cryptonets_with_vs_2022</code> of <a href=https://github.com/whcjimmy/SEAL/tree/cryptonets_with_vs_2022>my fork</a>.</p></li><li><p><strong>CryptoNets Repo</strong></p><p>You can get the repo from <a href=https://github.com/microsoft/CryptoNets>here</a>.</p></li><li><p><strong>NuGet Package command line tool</strong></p><p>Following the official manual, we need to pack SEAL Library into a NuGet package file. You can get the command-line tool from <a href=https://docs.microsoft.com/en-us/nuget/install-nuget-client-tools>here</a>.
<img src=/images/how-to-run-cryptonets-in-2022/2022-02-24-150732.png alt=image_7></p></li><li><p><strong>MNIST Dataset</strong></p><p>You can find the dataset from <a href=http://yann.lecun.com/exdb/mnist/>here</a>. Both training dataset and testing dataset are needed.</p></li></ol><h1 id=installation-guides>Installation Guides</h1><p>If eveything is set up, let&rsquo;s get started!</p><ol><li><p><strong>Install visual studio 2022</strong></p><p>You need to install VS 2022 with the following requirements:</p><ul><li>Desktop Development with C++</li><li>.Net Desktop Development</li><li>C++ Cmake tools for Windows</li><li>C++ Cmake tools for Linux</li><li>.Net Framework 4.8</li><li>.Net Framework 4.8 targeting pack</li><li>.Net Core 2.1 Runtime (out of support)
<img src=/images/how-to-run-cryptonets-in-2022/2022-02-24-162559.png alt=image_1>
<img src=/images/how-to-run-cryptonets-in-2022/2022-02-24-162613.png alt=image_2>
<img src=/images/how-to-run-cryptonets-in-2022/2022-02-24-162626.png alt=image_3>
<img src=/images/how-to-run-cryptonets-in-2022/2022-02-24-162646.png alt=image_4></li></ul></li><li><p><strong>Compile SEAL Library</strong> (the folloing steps are under SEAL Repo)</p><ol><li><p>Use VS to open <code>./donet/src/SEALNET.csproj</code> and accept all review solution actions.
<img src=/images/how-to-run-cryptonets-in-2022/2022-02-21-202909.png alt=image_5>
<img src=/images/how-to-run-cryptonets-in-2022/2022-02-21-202939.png alt=image_6></p></li><li><p>Build the following three projects after setting the configuration as <code>Release</code> and the platform as <code>x64</code>.</p><ol><li><code>./native/src/SEAL.vcxproj</code></li><li><code>./dotnet/native/SEALNetNative.vcxproj</code></li><li><code>./dotnet/src/SEALNet.csproj</code>
<img src=/images/how-to-run-cryptonets-in-2022/2022-02-24-111353.png alt=image_7>
<img src=/images/how-to-run-cryptonets-in-2022/2022-02-21-203125.png alt=image_7>
<img src=/images/how-to-run-cryptonets-in-2022/2022-02-24-111444.png alt=image_7></li></ol></li><li><p>Put NuGet command-line tool into <code>./dotnet/nuget</code> folder.
<img src=/images/how-to-run-cryptonets-in-2022/2022-02-24-111723.png alt=image_8></p></li><li><p>Open <code>./dotnet/nuget</code> with CMD and enter the following command to build nuget packages. The SEAL nupkg file is generated under <code>./dotnet/nuget/Release</code>.</p><p><code>nuget pack SEALNet.nuspec -properties Configuration=Release -Verbosity detailed -OutputDir Release</code>
<img src=/images/how-to-run-cryptonets-in-2022/2022-02-24-111619.png alt=image_9>
<img src=/images/how-to-run-cryptonets-in-2022/2022-02-24-111704.png alt=image_9></p></li><li><p>Copy the SEAL nupkg file to the root directory of CryptoNets Repo.
<img src=/images/how-to-run-cryptonets-in-2022/2022-02-24-111814.png alt=image_9></p></li></ol></li><li><p><strong>Compile CryptoNets Project</strong> (the folloing steps are under CryptoNets Repo)</p><ol><li><p>Use VS to open <code>./CryptoNets/CryptoNets.sln</code> and updfatre the .Net Framework version.
<img src=/images/how-to-run-cryptonets-in-2022/2022-02-21-203947.png alt=image_10>
<img src=/images/how-to-run-cryptonets-in-2022/2022-02-21-204004.png alt=image_11></p></li><li><p>Follow <code>Tool -> Nuget Package Manager -> Manage NuGet Packages for Solution</code> to import SEAL nupkg file.</p><p>If you cannot find the SEAL nupgk file, you may need to restart visual studio.
<img src=/images/how-to-run-cryptonets-in-2022/2022-02-21-205028.png alt=image_12></p></li><li><p>Build DataPreprocess and CryptoNets projects after set the configuration as <code>Debug</code> and the platform as <code>x64</code>, .
<img src=/images/how-to-run-cryptonets-in-2022/2022-02-21-205224.png alt=image_13>
<img src=/images/how-to-run-cryptonets-in-2022/2022-02-21-205241.png alt=image_14>
<img src=/images/how-to-run-cryptonets-in-2022/2022-02-21-204047.png alt=image_15>
<img src=/images/how-to-run-cryptonets-in-2022/2022-02-24-153204.png alt=image_15></p></li><li><p>Put the MNIST dataset files into <code>./bin/x64/Debug/</code>.
<img src=/images/how-to-run-cryptonets-in-2022/2022-02-21-205913.png alt=image_16></p></li></ol></li><li><p><strong>Run CryptoNets</strong> (the folloing steps are also under CryptoNets Repo)</p><ol><li>Open CMD and cd to <code>./bin/x64/Debug</code>.</li><li>Execute <code>DataPreprocess.exe MNIST</code> to generate <code>MNIST-28-28-test.txt</code> for CryptoNets.exe.
<img src=/images/how-to-run-cryptonets-in-2022/2022-02-21-210014.png alt=image_17></li><li>Execute <code>CryptoNets.exe</code>. This program will train a CNN model first and start to infer images in the encrypted domain.
<img src=/images/how-to-run-cryptonets-in-2022/2022-02-21-210425.png alt=image_18></li></ol></li></ol><h1 id=conclusion>Conclusion</h1><p>This post showed how to run CryptoNets with visual studio 2022. If you are interested in this research topic, there are other applications you can also try in the CryptoNets repo.</p><h1 id=references>References</h1><ol><li><a href=https://proceedings.mlr.press/v48/gilad-bachrach16.html>CryptoNets</a></li><li><a href=https://github.com/whcjimmy/SEAL/tree/CryptoNets_with_vs_2022>My fork of Microsoft SEAL Library</a></li><li><a href=https://github.com/microsoft/SEAL>The offical repo of SEAL</a></li><li><a href=https://github.com/microsoft/CryptoNets>The offical repo of CryptoNets</a></li></ol></article></main><footer id=footer>Copyright © 2023 Huan-Chih (Jimmy) Wang</footer></body></html>